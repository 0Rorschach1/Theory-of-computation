the algorithm is explained here:
